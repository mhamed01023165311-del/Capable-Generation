<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© V3</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Segoe UI', sans-serif;
            background: url('background.jpg') no-repeat center center;
            background-size: 100% 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            /* Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        }

        .logo {
            width: 120px;
            margin-top: 20px;
            z-index: 10;
        }

        #quiz-interface {
            display: none;
            background: rgba(0, 0, 0, 0.8);
            /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ø´ÙØ§ÙØ© */
            backdrop-filter: blur(5px);
            border: 2px solid #ffd700;
            border-radius: 25px;
            padding: 30px 20px;
            /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø´ÙŠ Ø§Ù„Ø£ÙÙ‚ÙŠØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            margin-top: 20px;
            width: 90%;
            /* Ø£ÙˆØ³Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            max-width: 500px;
            text-align: center;
            color: white;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            /* Ø¥Ø¶Ø§ÙØ© Ø¸Ù„ Ø°Ù‡Ø¨ÙŠ */
        }

        #q-text {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 2px 2px 4px #000000;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            /* Ù…Ø³Ø§ÙØ© Ù…ÙˆØ­Ø¯Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        }

        .ans-btn {
            width: 100%;
            padding: 18px 15px;
            /* Ø­Ø´ÙˆØ© Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ffd700;
            color: white;
            border-radius: 15px;
            /* Ø²ÙˆØ§ÙŠØ§ Ø£Ø¯Ù‚ */
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            /* ØªØ£Ø«ÙŠØ± Ù†Ø§Ø¹Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 2px black;
        }

        .ans-btn:hover {
            background: #ffd700;
            color: black;
            border-color: white;
            transform: scale(1.02);
            /* ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· */
            box-shadow: 0 0 20px #ffd700;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
        #admin-interface {
            display: none;
            background: #0b101b;
            color: white;
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 20px;
            overflow-y: auto;
            z-index: 2000;
        }

        .admin-box {
            background: #1a202c;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #ffd700;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border: none;
        }

        .session-block {
            background: #2d3748;
            padding: 10px;
            margin-top: 15px;
            border-radius: 8px;
            border-right: 4px solid #ffd700;
            position: relative;
            /* Ù„Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø·Ù„Ù‚ */
        }

        .delete-btn {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            position: absolute;
            top: 10px;
            left: 10px;
        }

        #login-screen {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid #ffd700;
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            width: 90%;
            max-width: 350px;
            color: white;
        }

        .login-box h3 {
            color: #ffd700;
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ffd700;
        }

        .login-box input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid #ffd700;
            color: white;
            padding: 15px;
            border-radius: 30px;
            font-size: 1rem;
            text-align: center;
        }

        .login-box input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            background: #ffd700;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: black;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .login-box button:hover {
            background: #ffed4e;
            transform: scale(1.03);
            box-shadow: 0 0 20px #ffd700;
        }
    </style>
</head>

<body>

    <img src="loge.png" class="logo" alt="Logo">

    <div id="login-screen">
        <div class="login-box">
            <h3>Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</h3>
            <input type="email" id="email-input" placeholder="Ø§ÙƒØªØ¨ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ">
            <button onclick="checkAccess()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="quiz-interface">
        <h2 id="q-text">ØªØ­Ù…ÙŠÙ„...</h2>
        <div class="options-container" id="options-box">
            <button class="ans-btn" id="btn1" onclick="submitAns(1)"></button>
            <button class="ans-btn" id="btn2" onclick="submitAns(2)"></button>
            <button class="ans-btn" id="btn3" onclick="submitAns(3)"></button>
            <button class="ans-btn" id="btn4" onclick="submitAns(4)"></button>
        </div>
    </div>

    <div id="admin-interface">
        <h2 style="color:#ffd700">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
        <div class="admin-box">
            <h4>Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ (Ø³ÙŠØ¨Ø¯Ø£ Ø£Ø±Ø´ÙŠÙ Ø¬Ø¯ÙŠØ¯):</h4>
            <input type="text" id="edit-q" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„">
            <input type="text" id="edit-a1" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 1">
            <input type="text" id="edit-a2" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 2">
            <input type="text" id="edit-a3" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 3">
            <input type="text" id="edit-a4" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 4">
            <input type="number" id="edit-correct" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ (1-4)">
            <button onclick="createNewQuestion()" style="width:100%; padding:12px; background:green; color:white; font-weight:bold; margin-top:10px; cursor:pointer;">Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <h3>ğŸ—„ï¸ Ø§Ù„Ø£Ø±Ø´ÙŠÙ (ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø¨Ø¥Ø¬Ø§Ø¨Ø§ØªÙ‡):</h3>
        <div id="archive-display"></div>
        <button onclick="location.reload()" style="background:red; color:white; padding:10px; margin-top:20px;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        const ADMIN_EMAIL = "admin@ramadan.com";
        let audioContext = null;
        let isAudioInitialized = false;

        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø§Ù„ØµÙØ­Ø©
        function initAudio() {
            if (isAudioInitialized) return;

            // Ø¥Ù†Ø´Ø§Ø¡ AudioContext (Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø±)
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            isAudioInitialized = true;
            console.log("AudioContext initialized");
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ø£ÙˆÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ Ù…ÙƒØ±Ø±Ø©)
        async function playMusic() {
            if (!audioContext) {
                initAudio();
            }

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
            if (audioContext.state === 'closed' || audioContext.state === 'suspended') {
                await audioContext.resume();
            }

            try {
                // Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„ØµÙˆØª
                const response = await fetch('music.mp3');
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                // ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†ÙŠ (Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£Ù‚Ù„)
                const duration = Math.min(5, audioBuffer.duration);
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                const sampleRate = audioBuffer.sampleRate;
                const samplesNeeded = duration * sampleRate;
                
                // Ø¥Ù†Ø´Ø§Ø¡ buffer Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ù…Ù‚ØªØ·Ø¹
                const trimmedBuffer = audioContext.createBuffer(
                    audioBuffer.numberOfChannels,
                    samplesNeeded,
                    sampleRate
                );

                // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù€ buffer Ø§Ù„Ø£ØµÙ„ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
                    const originalData = audioBuffer.getChannelData(channel);
                    const trimmedData = trimmedBuffer.getChannelData(channel);
                    for (let i = 0; i < samplesNeeded; i++) {
                        trimmedData[i] = originalData[i];
                    }
                }

                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµØ¯Ø± Ø§Ù„ØµÙˆØª
                const source = audioContext.createBufferSource();
                source.buffer = trimmedBuffer;
                source.loop = true; // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±
                source.connect(audioContext.destination);
                source.start();

                console.log(`ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ ${duration} Ø«ÙˆØ§Ù†ÙŠ Ù…Ù† Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙÙŠ Ø­Ù„Ù‚Ø© Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ©.`);

            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:", error);
            }
        }

        window.onload = function() {
            loadCurrentQuestion();

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„ (Ù…Ø«Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©)
            document.body.addEventListener('click', function initOnFirstClick() {
                initAudio();
                document.body.removeEventListener('click', initOnFirstClick);
            }, { once: true });
        };

        async function checkAccess() {
            const email = document.getElementById('email-input').value;
            if (!email) return;

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ø£ÙˆÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ Ù…ÙƒØ±Ø±Ø©)
            if (!isAudioInitialized) {
                initAudio();
            }
            await playMusic(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙÙˆØ± Ø¸Ù‡ÙˆØ± Ø´Ø§Ø´Ø© Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„

            document.getElementById('login-screen').style.display = 'none';
            if (email === ADMIN_EMAIL) {
                document.getElementById('admin-interface').style.display = 'block';
                renderArchive();
            } else {
                document.getElementById('quiz-interface').style.display = 'block';
                localStorage.setItem('user', email);
            }
        }

        function loadCurrentQuestion() {
            const q = JSON.parse(localStorage.getItem('current_q')) || {
                text: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªÙŠ ÙØ±Ø¶ ÙÙŠÙ‡Ø§ Ø§Ù„ØµÙŠØ§Ù…ØŸ",
                ans: ["1- Ø§Ù„Ø¨Ù‚Ø±Ø©", "2- Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "3- Ø§Ù„Ø£Ù†ÙØ§Ù„", "4- Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©"],
                correct: 1
            };
            document.getElementById('q-text').innerText = q.text;
            document.getElementById('btn1').innerText = q.ans[0];
            document.getElementById('btn2').innerText = q.ans[1];
            document.getElementById('btn3').innerText = q.ans[2];
            document.getElementById('btn4').innerText = q.ans[3];
        }

        function createNewQuestion() {
            const newQ = {
                id: Date.now(),
                text: document.getElementById('edit-q').value,
                ans: [
                    document.getElementById('edit-a1').value,
                    document.getElementById('edit-a2').value,
                    document.getElementById('edit-a3').value,
                    document.getElementById('edit-a4').value
                ],
                correct: parseInt(document.getElementById('edit-correct').value)
            };
            localStorage.setItem('current_q', JSON.stringify(newQ));

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ù„Ø£Ø±Ø´ÙŠÙ
            let archive = JSON.parse(localStorage.getItem('archive') || "[]");
            archive.push({ ...newQ, logs: [] });
            localStorage.setItem('archive', JSON.stringify(archive));

            alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯!");
            location.reload();
        }

        function submitAns(idx) {
            const currentQ = JSON.parse(localStorage.getItem('current_q'));
            let archive = JSON.parse(localStorage.getItem('archive') || "[]");

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù„Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
            if (archive.length > 0) {
                archive[archive.length - 1].logs.push({
                    user: localStorage.getItem('user'),
                    choiceText: currentQ.ans[idx - 1],
                    isCorrect: (idx == currentQ.correct)
                });
                localStorage.setItem('archive', JSON.stringify(archive));
            }
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø¨ØªÙƒ!");
        }

        function renderArchive() {
            const archive = JSON.parse(localStorage.getItem('archive') || "[]");
            const display = document.getElementById('archive-display');
            display.innerHTML = archive.map((item, index) => `
                <div class="session-block">
                    <button class="delete-btn" onclick="deleteSession(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    <strong>Ø§Ù„Ø³Ø¤Ø§Ù„: ${item.text}</strong>
                    <div style="font-size:12px; margin-top:10px;">
                        ${item.logs.length === 0 ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯' : item.logs.map(l => `
                            <p style="color:${l.isCorrect ? '#28a745' : '#ff4d4d'}">${l.user}: ${l.choiceText}</p>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function deleteSession(index) {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆÙƒÙ„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„ØªÙŠ Ø³Ø¬Ù„Øª ÙÙŠÙ‡ØŸ")) {
                let archive = JSON.parse(localStorage.getItem('archive') || "[]");
                archive.splice(index, 1);
                localStorage.setItem('archive', JSON.stringify(archive));
                renderArchive();
            }
        }
    </script>
</body>

</html>
