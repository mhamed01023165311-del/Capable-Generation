<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿ±ŸÖÿ∂ÿßŸÜ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            height: 100%;
            width: 100%;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #000;
        }

        #bg-video {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            transform: translateX(-50%) translateY(-50%);
            z-index: -1;
            object-fit: cover;
        }

        .logo {
            width: 120px;
            margin-bottom: 20px;
            z-index: 10;
            filter: drop-shadow(0 0 10px #ffd700);
        }

        #quiz-interface, #admin-interface, #login-screen {
            display: none;
        }

        #login-screen {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .login-box {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid #ffd700;
            padding: 50px 40px;
            border-radius: 30px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            color: white;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .login-box h3 {
            color: #ffd700;
            font-size: 2.2rem;
            margin-bottom: 25px;
            text-shadow: 0 0 10px #ffd700;
        }

        .login-box input {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid #ffd700;
            color: white;
            padding: 18px;
            border-radius: 40px;
            font-size: 1.1rem;
            text-align: center;
            width: 100%;
            margin: 15px 0;
        }

        .login-box button {
            width: 100%;
            padding: 18px;
            background: #ffd700;
            border: none;
            border-radius: 40px;
            font-size: 1.3rem;
            font-weight: bold;
            color: black;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .login-box button:hover {
            background: #ffed4e;
            transform: scale(1.02);
            box-shadow: 0 0 20px #ffd700;
        }

        #quiz-interface {
            background: transparent;
            border: 2px solid rgba(255, 215, 0, 0.7);
            border-radius: 25px;
            padding: 40px 30px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            color: white;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
            animation: slideUp 0.5s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #q-text {
            font-size: 2.2rem;
            margin-bottom: 35px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ans-btn {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ffd700;
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(2px);
        }

        .ans-btn:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: scale(1.02);
            box-shadow: 0 0 20px #ffd700;
        }

        .ans-btn:active {
            transform: scale(0.98);
        }

        #admin-interface {
            background: #0b101b;
            color: white;
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 20px;
            overflow-y: auto;
            z-index: 2000;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 15px;
        }

        .admin-header h2 {
            color: #ffd700;
            font-size: 2rem;
        }

        .admin-box {
            background: #1a202c;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #ffd700;
        }

        .admin-box h3 {
            color: #ffd700;
            margin-bottom: 15px;
            border-right: 4px solid #ffd700;
            padding-right: 10px;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: #2d3748;
            color: white;
            border: 1px solid #4a5568;
        }

        .save-btn {
            width: 100%;
            padding: 14px;
            background: #28a745;
            color: white;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        .classification-panel {
            background: #1a202c;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #ffd700;
        }

        .classification-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            flex: 1;
            background: #2d3748;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box.correct { border: 2px solid #28a745; }
        .stat-box.wrong { border: 2px solid #dc3545; }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-number.correct { color: #28a745; }
        .stat-number.wrong { color: #dc3545; }

        .classification-buttons {
            display: flex;
            gap: 15px;
        }

        .class-btn {
            flex: 1;
            padding: 15px;
            border-radius: 30px;
            font-size: 1.1rem;
            background: rgba(0,0,0,0.6);
            border: 2px solid;
            color: white;
            cursor: pointer;
        }

        .class-btn.correct { border-color: #28a745; }
        .class-btn.wrong { border-color: #dc3545; }

        .classification-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 10000;
            color: white;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .close-modal {
            background: none;
            border: none;
            color: #ffd700;
            font-size: 2rem;
            cursor: pointer;
        }

        .answer-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            border-right: 4px solid;
        }

        .answer-item.correct-item { border-right-color: #28a745; }
        .answer-item.wrong-item { border-right-color: #dc3545; }

        .user-email {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .session-block {
            background: #2d3748;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            border-right: 4px solid #ffd700;
            position: relative;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            position: absolute;
            top: 10px;
            left: 10px;
            cursor: pointer;
        }

        .toast-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
        }

        .toast-message {
            background: rgba(0,0,0,0.9);
            border: 2px solid #ffd700;
            color: white;
            padding: 12px 25px;
            border-radius: 40px;
            font-size: 1rem;
            border-right: 4px solid;
            animation: slideUp 0.3s;
        }

        .toast-message.success { border-right-color: #28a745; }
        .toast-message.error { border-right-color: #dc3545; }

        @media (max-width: 768px) {
            #quiz-interface {
                padding: 20px 15px;
                max-width: 400px;
            }
            
            #q-text { font-size: 1.6rem; }
            .ans-btn { padding: 15px; font-size: 1.1rem; }
            .classification-stats { flex-direction: column; }
            .classification-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <video autoplay muted loop id="bg-video">
        <source src="background.mp4" type="video/mp4">
    </video>

    <img src="loge.png" class="logo" alt="Logo" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%23ffd700%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22 fill=%22black%22>üåô</text></svg>'">

    <div class="toast-container" id="toastContainer"></div>

    <div id="login-screen" style="display: flex;">
        <div class="login-box">
            <h3>üåô ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</h3>
            <input type="email" id="email-input" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" value="admin@ramadan.com">
            <button onclick="login()">ÿØÿÆŸàŸÑ ‚ú®</button>
        </div>
    </div>

    <div id="quiz-interface">
        <h2 id="q-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</h2>
        <div class="options-container">
            <button class="ans-btn" onclick="submitAnswer(1)"></button>
            <button class="ans-btn" onclick="submitAnswer(2)"></button>
            <button class="ans-btn" onclick="submitAnswer(3)"></button>
            <button class="ans-btn" onclick="submitAnswer(4)"></button>
        </div>
    </div>

    <div id="admin-interface">
        <div class="admin-header">
            <h2>‚öôÔ∏è ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h2>
            <button onclick="logout()" style="background:#dc3545; color:white; padding:8px 15px; border:none; border-radius:5px;">üö™ ÿÆÿ±Ÿàÿ¨</button>
        </div>

        <div class="admin-box">
            <h3>‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ</h3>
            <input type="text" id="edit-q" placeholder="ÿßŸÑÿ≥ÿ§ÿßŸÑ" value="ŸÖÿß ŸáŸä ÿßŸÑÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ™Ÿä ŸÅÿ±ÿ∂ ŸÅŸäŸáÿß ÿßŸÑÿµŸäÿßŸÖÿü">
            <input type="text" id="edit-a1" placeholder="ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ£ŸàŸÑŸâ" value="ÿßŸÑÿ®ŸÇÿ±ÿ©">
            <input type="text" id="edit-a2" placeholder="ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©" value="ÿßŸÑŸÖÿßÿπŸàŸÜ">
            <input type="text" id="edit-a3" placeholder="ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©" value="ÿßŸÑÿ£ŸÜŸÅÿßŸÑ">
            <input type="text" id="edit-a4" placeholder="ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©" value="ÿßŸÑŸÖÿßÿ¶ÿØÿ©">
            <input type="number" id="edit-correct" placeholder="ÿ±ŸÇŸÖ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© (1-4)" value="1" min="1" max="4">
            <button class="save-btn" onclick="addQuestion()">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ§ÿßŸÑ</button>
        </div>

        <div class="classification-panel">
            <h3>üìä ÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™</h3>
            <div class="classification-stats" id="quickStats"></div>
            <div class="classification-buttons">
                <button class="class-btn correct" onclick="showClassification('correct')">‚úÖ ÿµÿ≠</button>
                <button class="class-btn wrong" onclick="showClassification('wrong')">‚ùå ÿ∫ŸÑÿ∑</button>
            </div>
        </div>

        <div class="admin-box">
            <h3>üóÇÔ∏è ÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</h3>
            <div id="archive-display"></div>
        </div>
    </div>

    <div id="classificationModal" class="classification-modal">
        <div class="modal-header">
            <h3 id="modalTitle">ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™</h3>
            <button class="close-modal" onclick="closeModal()">&times;</button>
        </div>
        <div id="answersList" class="answers-list"></div>
    </div>

    <script>
        let currentUser = null;
        let isAdmin = false;

        function showMessage(text, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-message ${type}`;
            toast.textContent = text;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        async function login() {
            const email = document.getElementById('email-input').value.trim();
            if (!email) return showMessage('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ', 'error');

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                
                if (data.success) {
                    currentUser = data.user;
                    isAdmin = data.isAdmin;
                    
                    document.getElementById('login-screen').style.display = 'none';
                    
                    if (isAdmin) {
                        document.getElementById('admin-interface').style.display = 'block';
                        loadAdminData();
                    } else {
                        document.getElementById('quiz-interface').style.display = 'block';
                        loadQuestion();
                    }
                    showMessage(isAdmin ? 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ£ŸäŸáÿß ÿßŸÑŸÖÿØŸäÿ±' : 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ');
                }
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ', 'error');
            }
        }

        async function loadQuestion() {
            try {
                const res = await fetch('/api/current-question');
                const q = await res.json();
                document.getElementById('q-text').textContent = q.text;
                document.querySelectorAll('.ans-btn').forEach((btn, i) => {
                    btn.textContent = q.answers[i];
                });
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ§ÿßŸÑ', 'error');
            }
        }

        async function submitAnswer(index) {
            if (!currentUser) return;
            try {
                const res = await fetch('/api/submit-answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentUser.email, answerIndex: index })
                });
                const data = await res.json();
                showMessage(data.message, data.isCorrect ? 'success' : 'error');
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©', 'error');
            }
        }

        async function addQuestion() {
            const q = {
                text: document.getElementById('edit-q').value,
                answers: [
                    document.getElementById('edit-a1').value,
                    document.getElementById('edit-a2').value,
                    document.getElementById('edit-a3').value,
                    document.getElementById('edit-a4').value
                ],
                correct: document.getElementById('edit-correct').value,
                adminEmail: 'admin@ramadan.com'
            };

            try {
                const res = await fetch('/api/add-question', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(q)
                });
                const data = await res.json();
                if (data.success) {
                    showMessage('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ§ÿßŸÑ');
                    setTimeout(() => location.reload(), 1500);
                }
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏', 'error');
            }
        }

        async function loadAdminData() {
            try {
                const res = await fetch('/api/stats?adminEmail=admin@ramadan.com');
                const data = await res.json();
                
                const last = data.archive[data.archive.length - 1] || { logs: [] };
                const correct = last.logs.filter(l => l.isCorrect).length;
                const wrong = last.logs.filter(l => !l.isCorrect).length;
                
                document.getElementById('quickStats').innerHTML = `
                    <div class="stat-box correct"><div class="stat-number correct">${correct}</div><div>ÿµÿ≠Ÿäÿ≠ÿ©</div></div>
                    <div class="stat-box wrong"><div class="stat-number wrong">${wrong}</div><div>ÿÆÿßÿ∑ÿ¶ÿ©</div></div>
                    <div class="stat-box"><div class="stat-number">${last.logs.length}</div><div>ÿ•ÿ¨ŸÖÿßŸÑŸä</div></div>
                `;
                
                document.getElementById('archive-display').innerHTML = data.archive.map(item => `
                    <div class="session-block">
                        <button class="delete-btn" onclick="deleteQuestion(${item.id})">üóëÔ∏è</button>
                        <strong>üìå ${item.text}</strong>
                        <div style="margin-top:10px; font-size:0.9rem;">
                            ${item.logs.map(l => `
                                <p style="color:${l.isCorrect ? '#28a745' : '#ff4d4d'}; margin:5px 0;">
                                    ${l.isCorrect ? '‚úÖ' : '‚ùå'} ${l.user}: ${l.choiceText}
                                </p>
                            `).join('') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿßÿ™'}
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
            }
        }

        async function deleteQuestion(id) {
            if (!confirm('ŸÖÿ™ÿ£ŸÉÿØÿü')) return;
            try {
                await fetch(`/api/delete-question/${id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminEmail: 'admin@ramadan.com' })
                });
                showMessage('ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ');
                loadAdminData();
            } catch (err) {
                showMessage('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ', 'error');
            }
        }

        async function showClassification(type) {
            const res = await fetch('/api/stats?adminEmail=admin@ramadan.com');
            const data = await res.json();
            const last = data.archive[data.archive.length - 1] || { logs: [] };
            const answers = last.logs.filter(l => type === 'correct' ? l.isCorrect : !l.isCorrect);
            
            document.getElementById('modalTitle').textContent = type === 'correct' ? '‚úÖ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©' : '‚ùå ÿßŸÑÿÆÿßÿ∑ÿ¶ÿ©';
            document.getElementById('answersList').innerHTML = answers.map(a => `
                <div class="answer-item ${type === 'correct' ? 'correct-item' : 'wrong-item'}">
                    <div class="user-email">üìß ${a.user}</div>
                    <div>üìù ${a.choiceText}</div>
                </div>
            `).join('') || '<div style="text-align:center; padding:20px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿßÿ™</div>';
            
            document.getElementById('classificationModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('classificationModal').style.display = 'none';
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
    </html>
